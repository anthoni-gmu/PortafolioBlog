{% extends 'base.html' %}

{% load static %}

{% load tailwind_tags %}
{% load tailwind_filters %}
{% load humanize %}

{% block title %}Post | {{post.title}}{% endblock title %}
{% block navbar %}
{% include 'components/navbar.html' %}
{% endblock navbar %}


<!-- main content -->
{% block content %}

<div class="container mx-auto px-2">
    <section class="grid md:grid-cols-3 mt-12">

        <main class="col-span-2 relative md:mr-2">
            <h1 class="text-3xl font-bold text-gray-800">{{post.title}}</h1>
            <div class="flex mt-2 my-2 items-center gap-4">
                <a href="#" class="block relative">
                    <img alt="profil" src="{{post.author.profile.pinture.url}}"
                        class="mx-auto object-cover rounded-full h-10 w-10 " />
                </a>
                <div class="text-gray-500">
                    Escrito por <span class="text-gray-800 cursor-pointer">{{post.author }} ||</span>
                    {{post.create_on|naturalday }}
                </div>
            </div>

            <div class="flex justify-center border">
                <img src="{{post.banner.url}} " class="object-cover w-full h-64" alt="placeholder tag" />
            </div>

            <article>
                <div
                    class="inline-flex items-center my-3 bg-white leading-none ${props.textColor} rounded-full p-2 shadow text-teal text-sm mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        style="fill: rgba(16, 185, 129, 1);transform: ;msFilter:;">
                        <path
                            d="M4 11h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1zm10 0h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-6a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1zM4 21h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1zm13 0c2.206 0 4-1.794 4-4s-1.794-4-4-4-4 1.794-4 4 1.794 4 4 4z">
                        </path>
                    </svg>
                    {% for categoria in post.category.all %}
                    <a href="#"
                        class="inline-flex mx-3 bg-green-500 text-white rounded-full h-6 px-3 justify-center items-center ">
                        {{categoria}}
                    </a>
                    {% endfor %}


                </div>
                <section>
                    {% for bodypost in bodyposts %}
                    {% if bodypost.type == "PARRAFO" %}
                    <p class="my-4">
                        {{bodypost.body}}
                    </p>
                    {% elif bodypost.type == "CODIGO" %}
                    <div class="w-24 min-w-full ">
                        <pre class="language-py "><code class="language-py">{{bodypost.body}}</code></pre>
                    </div>
                    {% elif bodypost.type == "TITULO" %}
                    <h1 class="text-3xl font-bold hover:text-gray-700 pb-4">{{bodypost.body}}</h1>
                    {% elif bodypost.type == "SUBTITULO" %}
                    <h1 class="text-2xl font-bold pb-3">{{bodypost.body}}</h1>
                    {% elif bodypost.type == "IMAGEN" %}
                    <img src="{{bodypost.imagen.url}}">
                    {% endif %}
                    {% endfor %}
                </section>

                <div
                    class="inline-flex items-center bg-white leading-none ${props.textColor} rounded-full p-2 shadow text-teal text-sm mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        style="fill: rgba(16, 185, 129, 1);transform: ;msFilter:;">
                        <path
                            d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8 8a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828l-8-8zM7 9a2 2 0 1 1 .001-4.001A2 2 0 0 1 7 9z">
                        </path>
                    </svg>
                    {% for tag in post.label.all %}
                    <a href="#"
                        class="inline-flex mx-3 bg-green-500 text-white rounded-full h-6 px-3 justify-center items-center">
                        {{tag}}
                    </a>
                    {% endfor %}


                </div>

            </article>
            {% if user.is_authenticated and user == post.author %}

            <div class=" flex md:justify-start mb-12 w-full" x-data="{ open: false }">
                <div class="">
                    <div class="">
                        <button type=" button" @click="open = true"
                            class="py-2 px-2   bg-green-500 hover:bg-green-700 focus:ring-green-500 focus:ring-offset-green-200 text-white w-full transition ease-in duration-200 text-center text-base font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2  rounded-lg ">
                            <div class="flex ">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    style="fill: rgb(255, 255, 255);transform: ;msFilter:;">
                                    <path
                                        d="M22 7.999a1 1 0 0 0-.516-.874l-9.022-5a1.003 1.003 0 0 0-.968 0l-8.978 4.96a1 1 0 0 0-.003 1.748l9.022 5.04a.995.995 0 0 0 .973.001l8.978-5A1 1 0 0 0 22 7.999zm-9.977 3.855L5.06 7.965l6.917-3.822 6.964 3.859-6.918 3.852z">
                                    </path>
                                    <path
                                        d="M20.515 11.126 12 15.856l-8.515-4.73-.971 1.748 9 5a1 1 0 0 0 .971 0l9-5-.97-1.748z">
                                    </path>
                                    <path
                                        d="M20.515 15.126 12 19.856l-8.515-4.73-.971 1.748 9 5a1 1 0 0 0 .971 0l9-5-.97-1.748z">
                                    </path>
                                </svg>
                                <p class="mx-3">Agregar Contenido</p>
                            </div>
                        </button>
                    </div>
                </div>
                <!--Modal {Publicar nuevo post} -->
                <div x-show="open" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200"
                    x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" @click.away="open = false"
                    class="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog"
                    aria-modal="true">
                    <div class=" min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">

                        <div x-show="open" x-transition:enter="ease-out duration-300"
                            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                            x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
                            x-transition:leave-end="opacity-0"
                            x-description="Background overlay, show/hide based on modal state."
                            class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="open = false"
                            aria-hidden="true"></div>

                        <span class="hidden sm:inline-block sm:align-middle sm:h-screen"
                            aria-hidden="true">&#8203;</span>


                        <div
                            class="inline-block align-bottom dark:bg-dark-second bg-white rounded-lg px-4
                            pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle">
                            <section class=" bg-gray-100 bg-opacity-50">
                                <form method="POST" enctype="multipart/form-data" class="shadow-md ">
                                    {% csrf_token %}
                                    <div class="space-y-4 bg-white">
                                        <div
                                            class="items-center w-full p-4 space-y-4 text-gray-500 md:inline-flex md:space-y-0">
                                            <h2 class="max-w-sm mx-auto md:w-1/3">
                                                Descripci√≥n
                                            </h2>
                                            <div class="max-w-sm mx-auto md:w-2/3">
                                                <div class=" relative ">
                                                    {{form.body}}
                                                </div>
                                            </div>
                                        </div>

                                        <div
                                            class="text-gray-500 items-center w-full p-4 space-y-4 lg:inline-flex lg:space-y-0 ">
                                            <h2 class="max-w-sm mx-auto md:w-1/3">
                                                Imagen
                                            </h2>
                                            <div class="max-w-sm mx-auto md:w-2/3">
                                                <div class=" relative ">

                                                    {{form.imagen}}

                                                </div>

                                            </div>
                                        </div>
                                        <hr />

                                        <div
                                            class="items-center w-full p-4 space-y-4 text-gray-500 md:inline-flex md:space-y-0">
                                            <h2 class="max-w-sm mx-auto md:w-1/3">
                                                Categoria
                                            </h2>
                                            <div class="max-w-sm mx-auto md:w-2/3">
                                                <div class=" relative ">
                                                    {{form.type}}
                                                </div>
                                            </div>
                                        </div>
                                        <hr />
                                        <div class="px-4 pb-4 ml-auto text-gray-500 md:w-1/3">
                                            <button type="submit"
                                                class="flex justify-center py-2 px-4   bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 focus:ring-offset-blue-200 text-white w-full transition ease-in duration-200 text-center text-base font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2  rounded-lg ">
                                                <p class="mx-3">Publicar</p><svg xmlns="http://www.w3.org/2000/svg"
                                                    width="24" height="24" viewBox="0 0 24 24"
                                                    style="fill: rgba(255, 255, 255, 1);transform: ;msFilter:;">
                                                    <path
                                                        d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zM4 12c0-.899.156-1.762.431-2.569L6 11l2 2v2l2 2 1 1v1.931C7.061 19.436 4 16.072 4 12zm14.33 4.873C17.677 16.347 16.687 16 16 16v-1a2 2 0 0 0-2-2h-4v-3a2 2 0 0 0 2-2V7h1a2 2 0 0 0 2-2v-.411C17.928 5.778 20 8.65 20 12a7.947 7.947 0 0 1-1.67 4.873z">
                                                    </path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </section>
                        </div>
                    </div>
                </div>
                <!--End Modal-->
            </div>
            {% endif %}

            <div x-data="{open:false}" class="py-2 px-4">
                <div class="border border-gray-200 dark:border-dark-third border-l-0 border-r-0 py-1">
                    <div class="flex space-x-2">





                        <div @click="open = true"
                            class="w-1/3 flex space-x-2 justify-center items-center hover:bg-gray-100 dark:hover:bg-dark-third text-xl py-2 rounded-lg cursor-pointer text-gray-500 dark:text-dark-txt">
                            <i class='bx bx-comment'></i>
                            <span class="text-sm font-semibold">Comentar</span>
                        </div>
                        <!--COmment MODAL-->
                        <!--COMMENT MODAL-->
                        <div x-show="open" x-transition:enter="ease-out duration-300"
                            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                            x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
                            x-transition:leave-end="opacity-0" @click.away="open = false"
                            class="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog"
                            aria-modal="true">
                            <div
                                class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">

                                <div x-show="open" x-transition:enter="ease-out duration-300"
                                    x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                                    x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
                                    x-transition:leave-end="opacity-0"
                                    x-description="Background overlay, show/hide based on modal state."
                                    class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                                    @click="open = false" aria-hidden="true"></div>

                                <span class="hidden sm:inline-block sm:align-middle sm:h-screen"
                                    aria-hidden="true">&#8203;</span>


                                <div
                                    class="inline-block align-bottom dark:bg-dark-second bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6">


                                    <div class="mt-3 text-center sm:mt-5">
                                        <h3 class="text-lg leading-6 font-medium dark:text-dark-txt text-gray-900"
                                            id="modal-title">
                                            Realizar comentario
                                        </h3>
                                        <div class="mt-2">
                                            <p class="text-sm dark:text-dark-txt text-gray-500">
                                                Recuerda ser educado en su comentario
                                            </p>
                                        </div>
                                    </div>

                                    <form method="POST" action="{% url 'social:comment-father' post.pk  %}">
                                        {% csrf_token %}
                                        {{formComment.comment}}
                                        <button type="submit"
                                            class="px-4 py-2  mt-3 block  text-base rounded-full text-green-600  bg-green-200">
                                            Comentar
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="py-2 px-4 max-w-full">
                <!-- COMMENT -->
                {% for comment in comments %}
                {% if comment.is_parent %}
                <div class="flex ">

                    <a href="{% url 'users:profile' comment.author.username %}">
                        <img src="{{comment.author.profile.pinture.url}}" alt="Profile picture"
                            class="max-w-sm mx-1 object-cover rounded-full h-10 w-10  ">
                    </a>
                    <div>
                        <div class="bg-gray-100 dark:bg-dark-third p-2 rounded-2xl text-sm">

                            <a href="{% url 'users:profile' username=post.author.username %}"
                                class="font-semibold block hover:text-blue-500 dark:text-dark-txt capitalize">
                                {% if comment.author.first_name and comment.author.last_name %}
                                {{comment.author.first_name}} {{comment.author.last_name}}
                                {% else %}
                                {{comment.author}}
                                {% endif %}
                                {% if comment.author.profile.verifield == "verified"%}<svg
                                    xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block text-green-500"
                                    viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                        clip-rule="evenodd" />
                                </svg>{% endif %}
                                <span
                                    class="text-xs  text-gray-500 float-right">{{comment.create_on|naturaltime}}</span>
                            </a>

                            <span class="text-lg">{{comment.comment}}</span>
                        </div>

                        <div x-data="{open:false}" class=" text-xs text-gray-500 dark:text-dark-txt my-2">
                            {% if request.user == comment.author %}
                            <a href="{% url 'social:comment-edit' post.pk comment.pk %}"
                                class="font-semibold mx-1 cursor-pointer">Editar</a>

                            <a href="{% url 'social:comment-delete' post.pk comment.pk %}"
                                class="font-semibold mx-1 cursor-pointer">Eliminar</a>
                            {% endif %}



                            <button @click="open = true"
                                class="inline-flex space-x-2 justify-center items-center hover:bg-gray-100 dark:hover:bg-dark-third text-sm  py-2 rounded-lg cursor-pointer text-gray-500 dark:text-dark-txt">
                                <i class='mr-2 bx bx-comment'></i>
                                Responder
                            </button>

                            <!-- This example requires Tailwind CSS v2.0+ -->
                            <div x-show="open" x-transition:enter="ease-out duration-300"
                                x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                                x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
                                x-transition:leave-end="opacity-0" @click.away="open = false"
                                class="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog"
                                aria-modal="true">
                                <div
                                    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">

                                    <div x-show="open" x-transition:enter="ease-out duration-300"
                                        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                                        x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
                                        x-transition:leave-end="opacity-0"
                                        x-description="Background overlay, show/hide based on modal state."
                                        class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                                        @click="open = false" aria-hidden="true"></div>


                                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen"
                                        aria-hidden="true">&#8203;</span>

                                    <div
                                        class="inline-block align-bottom dark:bg-dark-second dark:text-dark-txt bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6">
                                        <div>

                                            <div class="mt-3 text-center sm:mt-5">
                                                <div class="mt-3 text-center sm:mt-5">
                                                    <h3 class="text-lg leading-6 font-medium dark:text-dark-txt text-gray-900"
                                                        id="modal-title">
                                                        Responder comentario
                                                    </h3>
                                                    <div class="mt-2">
                                                        <p class="text-sm dark:text-dark-txt text-gray-500">
                                                            Recuerda ser educado en su respuesta
                                                        </p>
                                                    </div>
                                                </div>

                                                <form method="POST"
                                                    action="{% url 'social:comment-reply'  post.pk comment.pk %}">
                                                    <input type="hidden" name="next" value="{{request.path}}">
                                                    {% csrf_token %}
                                                    {{formComment.comment}}
                                                    <button type="submit"
                                                        class="px-4 py-2  mt-3 block  text-base rounded-full text-green-600  bg-green-200">
                                                        Responder
                                                    </button>
                                                </form>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>



                        </div>

                        <!-- REPLY COMMENT -->
                        {% for child_comment in comment.children %}
                        <div class="flex ">
                            <a href="{% url 'users:profile' comment.author.username %}">
                                <img src="{{child_comment.author.profile.pinture.url}}" alt="Profile picture"
                                    class="max-w-sm mx-1 object-cover rounded-full h-10 w-10  ">
                            </a>
                            <div>
                                <div class="bg-gray-100 dark:bg-dark-third p-2 rounded-2xl text-sm">
                                    <a href="{% url 'users:profile' username=post.author.username %}"
                                        class="font-semibold block hover:text-blue-500 dark:text-dark-txt">


                                        {% if child_comment.author.first_name and child_comment.author.last_name %}
                                        {{child_comment.author.first_name}} {{child_comment.author.last_name}}
                                        {% else %}
                                        {{child_comment.author}}
                                        {% endif %}
                                        {% if child_comment.author.profile.verifield == "verified"%}<svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-5 w-5 inline-block text-green-500" viewBox="0 0 20 20"
                                            fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                clip-rule="evenodd" />
                                        </svg>{% endif %}
                                        <span
                                            class="text-xs dark:text-dark-txt  text-gray-500 float-right">{{child_comment.create_on|naturaltime}}</span>

                                    </a>
                                    <span class="text-lg">{{child_comment.comment}}</span>

                                </div>
                                <div class="p-2 text-xs text-gray-500 dark:text-dark-txt">
                                    {% if request.user == child_comment.author %}
                                    <a href="{% url 'social:comment-edit' post.pk child_comment.pk %}"
                                        class="font-semibold cursor-pointer mx-2">Editar</a>
                                    <a href="{% url 'social:comment-delete' post.pk child_comment.pk %}"
                                        class="font-semibold cursor-pointer mx-2">Eliminar</a>
                                    {% endif %}

                                </div>
                            </div>
                        </div>
                        {% endfor %}

                        <!-- END REPLY COMMENT -->

                    </div>
                </div>
                {% endif %}
                {% endfor %}

                <!-- END COMMENT -->

            </div>
        </main>
        <aside class="col-span-2 md:col-span-1 mt-4 md:mt-0">
            <div class="mb-8 ">
                <p class="text-3xl font-semibold border-l-4 border-gray-800 pl-2 my-8 text-gray-700">Explorar categor√≠as
                </p>
                <ul class="ml-3 text-lg font-semibold text-gray-700 ">
                    {% for cate,count in mylist%}
                    <form action="{% url 'social:category-search' %}" method="GET"
                        class="border py-2 px-2 mt-2 mb-1 cursor-pointer hover:text-gray-900 rounded-sm flex justify-between">
                        <input type="hidden" name="query" value="{{cate}}" placeholder="Buscar por categoria">
                        <button type="submit" class="w-full">
                            <li class="">
                                <span class="float-left ">{{cate}}</span>
                                <span class="text-gray-900 float-right"> {{count.category__count}}</span>
                            </li>
                        </button>
                    </form>
                    {% endfor %}
                </ul>
            </div>

            <div id="related-posts" class="grid gap-2">
                <p class="text-3xl font-semibold border-l-4 my-8 border-gray-800 pl-2 text-gray-700">Art√≠culos
                    Relacionados
                </p>
                {% for object in relacionPost %}

                {% if post != object%}
                <div>
                    <div class="grid grid-cols-2   border rounded-lg">

                        <a href="{% url 'social:post-detail' object.pk %}" class=" md:col-span-2 lg:col-span-1">
                            <img src="{{object.banner.url}}" class="w-full h-auto" alt="{{object.title}}">
                        </a>
                        <div class="col-span-1 md:col-span-2 lg:col-span-1 px-2 flex flex-col justify-center">
                            <a href="{% url 'social:post-detail' object.pk %}" class="text-xl cursor-pointer">
                                {{ object.title}}
                            </a>
                            <p class="text-gray-600">{{ object.description}}</p>
                        </div>
                    </div>
                </div>
                {% endif %}


                {% endfor %}


            </div>
        </aside>
    </section>
</div>


{% endblock content %}



<!-- FOOTER -->
{% block footer %}
{% include 'components/footer.html' %}
{% endblock footer %}


{% block javascript %}
<script src="{% static 'js/prism.js' %}"></script>
{% endblock javascript %}